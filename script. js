// Мобильное меню
const menuToggle = document.querySelector('.menu-toggle');
const navMenu = document.querySelector('.nav-menu');

menuToggle.addEventListener('click', () => {
    navMenu.classList.toggle('active');
});

// Закрытие меню при клике на ссылку
document.querySelectorAll('.nav-menu a').forEach(link => {
    link.addEventListener('click', () => {
        navMenu.classList.remove('active');
    });
});

// Таймер обратного отсчета
function updateTimer() {
    const now = new Date();
    const target = new Date();
    target.setDate(now.getDate() + 14); // Установим цель на 14 дней вперед

    const diff = target - now;

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    document.getElementById('days').textContent = days.toString().padStart(2, '0');
    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
}

setInterval(updateTimer, 1000);
updateTimer(); // Инициализация сразу

// Обработка формы предзаказа
const preorderForm = document.getElementById('preorder-form');
preorderForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;

    // Здесь обычно отправка на сервер
    alert(`Спасибо, ${name}! Ваша заявка на предзаказ принята. Мы свяжемся с вами по email ${email} в ближайшее время.`);
    preorderForm.reset();
});

// Модальное окно для видео
const videoDemoBtn = document.querySelector('a[href="#video-demo"]');
const modal = document.getElementById('video-demo');
const closeModal = document.querySelector('.close-modal');

videoDemoBtn.addEventListener('click', (e) => {
    e.preventDefault();
    modal.style.display = 'flex';
});

closeModal.addEventListener('click', () => {
    modal.style.display = 'none';
});

// Закрытие модального окна при клике вне его
window.addEventListener('click', (e) => {
    if (e.target === modal) {
        modal.style.display = 'none';
    }
});

// Интерактивный слайдер "До/После"
const sliderBar = document.querySelector('.slider-bar');
const sliderHandle = document.querySelector('.slider-handle');
const beforeAfter = document.querySelector('.before-after');

let isDragging = false;

sliderBar.addEventListener('mousedown', startDrag);
sliderBar.addEventListener('touchstart', startDrag);

window.addEventListener('mousemove', drag);
window.addEventListener('touchmove', drag);
window.addEventListener('mouseup', stopDrag);
window.addEventListener('touchend', stopDrag);

function startDrag(e) {
    e.preventDefault();
    isDragging = true;
}

function drag(e) {
    if (!isDragging) return;
    let clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const barRect = sliderBar.getBoundingClientRect();
    let percent = (clientX - barRect.left) / barRect.width;
    percent = Math.max(0, Math.min(1, percent)); // Ограничение от 0 до 1
    sliderHandle.style.left = `${percent * 100}%`;
    beforeAfter.style.clipPath = `inset(0 ${(1 - percent) * 100}% 0 0)`;
}

function stopDrag() {
    isDragging = false;
}

// Анимация карточек при скролле
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animated');
        }
    });
}, observerOptions);

document.querySelectorAll('.feature-card, .solution-card, .spec').forEach(el => observer.observe(el));
